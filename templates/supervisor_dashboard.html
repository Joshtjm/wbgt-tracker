{% extends "layout.html" %}
{% block content %}
<h2 class="text-lg font-semibold text-center mb-4">Supervisor Dashboard</h2>
<p class="text-sm text-center text-gray-500 mb-4">Monitoring all users in your assigned group ({{ session.group }})</p>

<table class="table-auto w-full border text-sm bg-white shadow rounded">
  <thead class="bg-gray-100">
    <tr>
      <th class="p-2 border">User</th>
      <th class="p-2 border">Zone</th>
      <th class="p-2 border">Status</th>
      <th class="p-2 border">Start</th>
      <th class="p-2 border">End</th>
      <th class="p-2 border">Remaining</th>
    </tr>
  </thead>
  <tbody>
    {% for user in group_users %}
    <tr>
      <td class="p-2 border font-medium">{{ user.username }}</td>
      <td class="p-2 border">{{ user.zone }}</td>
      <td class="p-2 border">{{ user.status }}</td>
      <td class="p-2 border">{{ user.start_time }}</td>
      <td class="p-2 border">{{ user.end_time }}</td>
      <td class="p-2 border">
        {% if user.status != 'idle' %}
          {{ (datetime.strptime(user.end_time, '%H:%M:%S') - datetime.strptime(user.start_time, '%H:%M:%S')).seconds // 60 }} min
        {% else %}
          --
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
const socket = io();
socket.on("status_update", function(data) {
  console.log("Live update received:", data);
  location.reload();
});
</script>
{% endblock %}
